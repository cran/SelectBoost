<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="date" content="2020-02-23" />

<title>Simulation Tools Provided With the Selectboost Package</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Simulation Tools Provided With the Selectboost Package</h1>
<h4 class="author">Frédéric Bertrand and Myriam Maumy-Bertrand</h4>
<address class="author_afil">
Université de Strasbourg and CNRS<br><a class="author_email" href="mailto:#"><a href="mailto:frederic.bertrand@math.unistra.fr" class="email">frederic.bertrand@math.unistra.fr</a></a>
</address>
<h4 class="date">2020-02-23</h4>



<div id="contents" class="section level1">
<h1>Contents</h1>
<p>This vignette details the simulations tools provided with the selectboost package by providing five examples of use.</p>
<p>If you are a Linux/Unix or a Macos user, you can install a version of SelectBoost with support for <code>doMC</code> from <a href="https://github.com">github</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;fbertran/SelectBoost&quot;</span>, <span class="dt">ref =</span> <span class="st">&quot;doMC&quot;</span>)</a></code></pre></div>
</div>
<div id="first-example" class="section level1">
<h1>First example</h1>
<div id="aim" class="section level2">
<h2>Aim</h2>
<p>We want to creates <span class="math inline">\(NDatasets=200\)</span> datasets with <span class="math inline">\(\textrm{length}(group)=10\)</span> variables and <span class="math inline">\(N=10\)</span> observations. In that example we want <span class="math inline">\(9\)</span> groups:</p>
<ul>
<li><span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_{10}\)</span> belong to the first group and the intra-group Pearson correlation for this group is equal to <span class="math inline">\(.95\)</span>,</li>
<li><span class="math inline">\(x_2\)</span> belongs to the second group,</li>
<li><span class="math inline">\(x_3\)</span> belongs to the third group,</li>
<li>…</li>
<li><span class="math inline">\(x_9\)</span> belongs to the ninth group.</li>
</ul>
</div>
<div id="correlation-structure" class="section level2">
<h2>Correlation structure</h2>
<p>The correlation structure of the explanatory variables of the dataset is provided by <code>group</code> and the intra-group Pearson correlation value for each of the groups by <code>cor_group</code>. A value must be provided even for single variable groups and the number of variables is length of the <code>group</code> vector. Use the <code>simulation_cor</code> function to create the correlation matrix (<code>CM</code>).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(SelectBoost)</a>
<a class="sourceLine" id="cb2-2" title="2">group&lt;-<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>,<span class="dv">1</span>) <span class="co">#10 variables</span></a>
<a class="sourceLine" id="cb2-3" title="3">cor_group&lt;-<span class="kw">rep</span>(<span class="fl">0.95</span>,<span class="dv">9</span>)</a>
<a class="sourceLine" id="cb2-4" title="4">CM&lt;-<span class="kw">simulation_cor</span>(group,cor_group)</a>
<a class="sourceLine" id="cb2-5" title="5">CM</a></code></pre></div>
</div>
<div id="explanatory-dataset-generation" class="section level2">
<h2>Explanatory dataset generation</h2>
<p>Then generation of an explanatory dataset with <span class="math inline">\(N=10\)</span> observations is made by the <code>simulation_X</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">set.seed</span>(<span class="dv">3141</span>)</a>
<a class="sourceLine" id="cb3-2" title="2">N&lt;-<span class="dv">10</span></a>
<a class="sourceLine" id="cb3-3" title="3">X&lt;-<span class="kw">simulation_X</span>(N,CM)</a>
<a class="sourceLine" id="cb3-4" title="4">X</a></code></pre></div>
</div>
<div id="response-derivation" class="section level2">
<h2>Response derivation</h2>
<p>A response can now be added to the dataset by the <code>simulation_Data</code> function. We have to specifiy the support of the response, i.e. the explanatory variables that will be used in the linear model created to compute the response. The support is given by the <code>supp</code> vector whose entries are either <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>. The length of the <code>supp</code> vector must be equal to the number of explanatory variables and if the <span class="math inline">\(i\)</span>entry is equal to <span class="math inline">\(1\)</span>, it means that the <span class="math inline">\(i\)</span>variable will be used to derive the response value, whereas if the <span class="math inline">\(i\)</span>entry is equal to <span class="math inline">\(0\)</span>, it means that the <span class="math inline">\(i\)</span>variable will not be used to derive the response value (<code>beta&lt;-rep(0,length(supp))</code>). The values of the coefficients for the explanatory variables that are in the support of the response are random (either absolute value and sign) and given by <code>beta[which(supp==1)]&lt;-runif(sum(supp),minB,maxB)*(rbinom(sum(supp),1,.5)*2-1)</code>. Hence, the user can specify their minimal absolute value with the <code>minB</code> option and their maximal absolute value with the <code>maxB</code> option. The <code>stn</code> option is a scaling factor for the noise added to the response vector (<code>(t(beta)%*%var(X)%*%beta)/stn</code>, with <code>X</code> the matrix of explanatory variables). The higher the <code>stn</code> value, the smaller the noise: for instance for a given <code>X</code> dataset, an <code>stn</code> value <span class="math inline">\(\alpha\)</span> times larger will result in a noise exactly <span class="math inline">\(\sqrt{\alpha}\)</span> times smaller.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">set.seed</span>(<span class="dv">3141</span>)</a>
<a class="sourceLine" id="cb4-2" title="2">supp&lt;-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-3" title="3">minB&lt;-<span class="dv">1</span></a>
<a class="sourceLine" id="cb4-4" title="4">maxB&lt;-<span class="dv">2</span></a>
<a class="sourceLine" id="cb4-5" title="5">stn&lt;-<span class="dv">50</span></a>
<a class="sourceLine" id="cb4-6" title="6">firstdataset=<span class="kw">simulation_DATA</span>(X,supp,minB,maxB,stn)</a>
<a class="sourceLine" id="cb4-7" title="7">firstdataset</a></code></pre></div>
</div>
<div id="multiple-datasets-and-checks" class="section level2">
<h2>Multiple datasets and checks</h2>
<p>To generate multiple datasets, repeat steps 2 and 3, for instance use a <code>for</code> loop. We create <span class="math inline">\(NDatasets=200\)</span> datasets and assign them to the objects <code>DATA_exemple1_nb_1</code> to <code>DATA_exemple1_nb_200</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">set.seed</span>(<span class="dv">3141</span>)</a>
<a class="sourceLine" id="cb5-2" title="2">NDatasets=<span class="dv">200</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb5-4" title="4">X&lt;-<span class="kw">simulation_X</span>(N,CM)</a>
<a class="sourceLine" id="cb5-5" title="5"><span class="kw">assign</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple1_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="kw">simulation_DATA</span>(X,supp,minB,maxB,stn))</a>
<a class="sourceLine" id="cb5-6" title="6">}</a></code></pre></div>
<p>We now check the correlation structure of the explanatory variable. First we compute the mean correlation matrix.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">corr_sum=<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(group),<span class="kw">length</span>(group))</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb6-3" title="3">corr_sum=corr_sum<span class="op">+</span><span class="kw">cor</span>(<span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple1_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X)</a>
<a class="sourceLine" id="cb6-4" title="4">}</a>
<a class="sourceLine" id="cb6-5" title="5">corr_mean=corr_sum<span class="op">/</span>NDatasets</a></code></pre></div>
<p>Then we display and plot that the mean correlation matrix.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">corr_mean</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">plot</span>(<span class="kw">abs</span>(corr_mean))</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">coef_sum=<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(group))</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">names</span>(coef_sum)&lt;-<span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(group),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb8-3" title="3">error_counter=<span class="dv">0</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb8-5" title="5">tempdf=<span class="kw">data.frame</span>(<span class="kw">cbind</span>(<span class="dt">Y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple1_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y,</a>
<a class="sourceLine" id="cb8-6" title="6">                        <span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple1_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X))</a>
<a class="sourceLine" id="cb8-7" title="7">tempcoef=<span class="kw">coef</span>(<span class="kw">lm</span>(Y<span class="op">~</span>.<span class="op">-</span><span class="dv">1</span>,<span class="dt">data=</span>tempdf))</a>
<a class="sourceLine" id="cb8-8" title="8"><span class="cf">if</span>(<span class="kw">is.null</span>(tempcoef)){</a>
<a class="sourceLine" id="cb8-9" title="9"><span class="kw">cat</span>(<span class="st">&quot;Error in lm fit, skip coefficients</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb8-10" title="10">error_counter=error_counter<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb8-11" title="11">  } <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb8-12" title="12">coef_sum=coef_sum<span class="op">+</span><span class="kw">abs</span>(tempcoef)</a>
<a class="sourceLine" id="cb8-13" title="13">}</a>
<a class="sourceLine" id="cb8-14" title="14">}</a>
<a class="sourceLine" id="cb8-15" title="15">error_counter</a>
<a class="sourceLine" id="cb8-16" title="16">coef_mean=coef_sum<span class="op">/</span>NDatasets</a></code></pre></div>
<p>All fits were sucessful. Then we display and plot that the mean coefficient vector values.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">coef_mean</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">barplot</span>(coef_mean)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">abline</span>(<span class="dt">h=</span>(minB<span class="op">+</span>maxB)<span class="op">/</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p>Reduce the noise in the response for the new responses by a factor <span class="math inline">\(\sqrt{5000/50}=10\)</span>. <span class="math inline">\(1/stn\cdot \beta_{support}^t\mathrm{Var}(X)\beta_{support}\)</span> where <span class="math inline">\(\beta_{support}\)</span> is the vector of coefficients wh</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">set.seed</span>(<span class="dv">3141</span>)</a>
<a class="sourceLine" id="cb10-2" title="2">stn &lt;-<span class="st"> </span><span class="dv">5000</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb10-4" title="4">X&lt;-<span class="kw">simulation_X</span>(N,CM)</a>
<a class="sourceLine" id="cb10-5" title="5"><span class="kw">assign</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple1_bis_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="kw">simulation_DATA</span>(X,supp,minB,maxB,stn))</a>
<a class="sourceLine" id="cb10-6" title="6">}</a></code></pre></div>
<p>Since it is the same explanatory dataset for response generation, we can compare the <span class="math inline">\(\sigma\)</span> between those <span class="math inline">\(NDatasets=200\)</span> datasets.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">stn_ratios=<span class="kw">rep</span>(<span class="dv">0</span>,NDatasets)</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb11-3" title="3">stn_ratios[i]&lt;-<span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple1_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>sigma<span class="op">/</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="st">  </span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple1_bis_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>sigma</a>
<a class="sourceLine" id="cb11-5" title="5">}</a>
<a class="sourceLine" id="cb11-6" title="6"><span class="kw">all</span>(<span class="kw">sapply</span>(stn_ratios,all.equal,<span class="dv">10</span>))</a></code></pre></div>
<p>All the ratios are equal to 10 as anticipated.</p>
<p>Since, the correlation structure is the same as before, we do not need to check it again. As befor, we infer the coefficients values of a linear model using the <code>lm</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">coef_sum_bis=<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(group))</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">names</span>(coef_sum_bis)&lt;-<span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(group),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb12-3" title="3">error_counter_bis=<span class="dv">0</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb12-5" title="5">tempdf=<span class="kw">data.frame</span>(<span class="kw">cbind</span>(<span class="dt">Y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple1_bis_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y,</a>
<a class="sourceLine" id="cb12-6" title="6">                        <span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple1_bis_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X))</a>
<a class="sourceLine" id="cb12-7" title="7">tempcoef=<span class="kw">coef</span>(<span class="kw">lm</span>(Y<span class="op">~</span>.<span class="op">-</span><span class="dv">1</span>,<span class="dt">data=</span>tempdf))</a>
<a class="sourceLine" id="cb12-8" title="8"><span class="cf">if</span>(<span class="kw">is.null</span>(tempcoef)){</a>
<a class="sourceLine" id="cb12-9" title="9"><span class="kw">cat</span>(<span class="st">&quot;Error in lm fit, skip coefficients</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb12-10" title="10">error_counter_bis=error_counte_bisr<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb12-11" title="11">  } <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb12-12" title="12">coef_sum_bis=coef_sum_bis<span class="op">+</span><span class="kw">abs</span>(tempcoef)</a>
<a class="sourceLine" id="cb12-13" title="13">}</a>
<a class="sourceLine" id="cb12-14" title="14">}</a>
<a class="sourceLine" id="cb12-15" title="15">error_counter_bis</a>
<a class="sourceLine" id="cb12-16" title="16">coef_mean_bis=coef_sum_bis<span class="op">/</span>NDatasets</a></code></pre></div>
<p>All fits were sucessful. Then we display and plot that the mean coefficient vector values. As expected, the noise reduction enhances the retrieval of the <code>true</code> mean coefficient absolute values by the models.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">coef_mean_bis</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">barplot</span>(coef_mean_bis)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">abline</span>(<span class="dt">h=</span>(minB<span class="op">+</span>maxB)<span class="op">/</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p>The simulation process looks sucessfull. What are the confidence indices for those variables?</p>
</div>
</div>
<div id="second-example" class="section level1">
<h1>Second example</h1>
<div id="aim-1" class="section level2">
<h2>Aim</h2>
<p>We want to creates <span class="math inline">\(NDatasets=200\)</span> datasets with <span class="math inline">\(\textrm{length}(group)=50\)</span> variables and <span class="math inline">\(N=20\)</span> observations. In that example we want <span class="math inline">\(1\)</span> group:</p>
<ul>
<li><span class="math inline">\(x_1\)</span>, , <span class="math inline">\(x_{50}\)</span> belong to the same group and the intra-group Pearson correlation for this group is equal to <span class="math inline">\(.5\)</span>.</li>
<li>only the first five variables <span class="math inline">\(x_1\)</span>, , <span class="math inline">\(x_{5}\)</span> are explanatory variables for the response.</li>
</ul>
</div>
<div id="correlation-structure-1" class="section level2">
<h2>Correlation structure</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">group&lt;-<span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">50</span>) <span class="co">#50 variables</span></a>
<a class="sourceLine" id="cb14-2" title="2">cor_group&lt;-<span class="kw">rep</span>(<span class="fl">0.5</span>,<span class="dv">1</span>)</a></code></pre></div>
</div>
<div id="explanatory-variables-and-response" class="section level2">
<h2>Explanatory variables and response</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">set.seed</span>(<span class="dv">3141</span>)</a>
<a class="sourceLine" id="cb15-2" title="2">N&lt;-<span class="dv">20</span></a>
<a class="sourceLine" id="cb15-3" title="3">supp&lt;-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">45</span>))</a>
<a class="sourceLine" id="cb15-4" title="4">minB&lt;-<span class="dv">1</span></a>
<a class="sourceLine" id="cb15-5" title="5">maxB&lt;-<span class="dv">2</span></a>
<a class="sourceLine" id="cb15-6" title="6">stn&lt;-<span class="dv">50</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">200</span>){</a>
<a class="sourceLine" id="cb15-8" title="8">C&lt;-<span class="kw">simulation_cor</span>(group,cor_group)</a>
<a class="sourceLine" id="cb15-9" title="9">X&lt;-<span class="kw">simulation_X</span>(N,C)</a>
<a class="sourceLine" id="cb15-10" title="10"><span class="kw">assign</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple2_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="kw">simulation_DATA</span>(X,supp,minB,maxB,stn))</a>
<a class="sourceLine" id="cb15-11" title="11">}</a></code></pre></div>
</div>
<div id="checks" class="section level2">
<h2>Checks</h2>
<p>We now check the correlation structure of the explanatory variable. First we compute the mean correlation matrix.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">corr_sum=<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(group),<span class="kw">length</span>(group))</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb16-3" title="3">corr_sum=corr_sum<span class="op">+</span><span class="kw">cor</span>(<span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple2_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X)</a>
<a class="sourceLine" id="cb16-4" title="4">}</a>
<a class="sourceLine" id="cb16-5" title="5">corr_mean=corr_sum<span class="op">/</span>NDatasets</a></code></pre></div>
<p>Then we display and plot that the mean correlation matrix.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">corr_mean[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw">plot</span>(<span class="kw">abs</span>(corr_mean))</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">coef_sum=<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(group))</a>
<a class="sourceLine" id="cb18-2" title="2">coef_lasso_sum=<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(group))</a>
<a class="sourceLine" id="cb18-3" title="3"><span class="kw">names</span>(coef_sum)&lt;-<span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(group),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb18-4" title="4"><span class="kw">names</span>(coef_lasso_sum)&lt;-<span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(group),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb18-5" title="5">error_counter=<span class="dv">0</span></a>
<a class="sourceLine" id="cb18-6" title="6"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb18-7" title="7">tempdf=<span class="kw">data.frame</span>(<span class="kw">cbind</span>(<span class="dt">Y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple2_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y,</a>
<a class="sourceLine" id="cb18-8" title="8">                        <span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple2_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X))</a>
<a class="sourceLine" id="cb18-9" title="9">tempcoef=<span class="kw">coef</span>(<span class="kw">lm</span>(Y<span class="op">~</span>.<span class="op">-</span><span class="dv">1</span>,<span class="dt">data=</span>tempdf))</a>
<a class="sourceLine" id="cb18-10" title="10"><span class="kw">require</span>(lars)</a>
<a class="sourceLine" id="cb18-11" title="11">lasso<span class="fl">.1</span> &lt;-<span class="st"> </span>lars<span class="op">::</span><span class="kw">lars</span>(<span class="dt">x=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple2_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X,</a>
<a class="sourceLine" id="cb18-12" title="12">              <span class="dt">y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple2_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y, <span class="dt">type=</span><span class="st">&quot;lasso&quot;</span>, </a>
<a class="sourceLine" id="cb18-13" title="13">              <span class="dt">trace=</span><span class="ot">FALSE</span>, <span class="dt">normalize=</span><span class="ot">FALSE</span>, <span class="dt">intercept =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb18-14" title="14"><span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span></a>
<a class="sourceLine" id="cb18-15" title="15">cv.lasso<span class="fl">.1</span> &lt;-<span class="st"> </span>lars<span class="op">::</span><span class="kw">cv.lars</span>(<span class="dt">x=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple2_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X,</a>
<a class="sourceLine" id="cb18-16" title="16">              <span class="dt">y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple2_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y, </a>
<a class="sourceLine" id="cb18-17" title="17">              <span class="dt">plot.it=</span><span class="ot">FALSE</span>, <span class="dt">type=</span><span class="st">&quot;lasso&quot;</span>)</a>
<a class="sourceLine" id="cb18-18" title="18"><span class="co"># Use the &quot;+1SE rule&quot; to find best model: </span></a>
<a class="sourceLine" id="cb18-19" title="19"><span class="co">#    Take the min CV and add its SE (&quot;limit&quot;).  </span></a>
<a class="sourceLine" id="cb18-20" title="20"><span class="co">#    Find smallest model that has its own CV within this limit (at &quot;s.cv.1&quot;)</span></a>
<a class="sourceLine" id="cb18-21" title="21">limit &lt;-<span class="st"> </span><span class="kw">min</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv) <span class="op">+</span><span class="st"> </span>cv.lasso<span class="fl">.1</span><span class="op">$</span>cv.error[<span class="kw">which.min</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv)]</a>
<a class="sourceLine" id="cb18-22" title="22">s.cv<span class="fl">.1</span> &lt;-<span class="st"> </span>cv.lasso<span class="fl">.1</span><span class="op">$</span>index[<span class="kw">min</span>(<span class="kw">which</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv <span class="op">&lt;</span><span class="st"> </span>limit))]</a>
<a class="sourceLine" id="cb18-23" title="23"><span class="co"># Print out coefficients at optimal s.</span></a>
<a class="sourceLine" id="cb18-24" title="24">coef_lasso_sum=coef_lasso_sum<span class="op">+</span><span class="kw">abs</span>(<span class="kw">coef</span>(lasso<span class="fl">.1</span>, <span class="dt">s=</span>s.cv<span class="fl">.1</span>, <span class="dt">mode=</span><span class="st">&quot;fraction&quot;</span>))</a>
<a class="sourceLine" id="cb18-25" title="25"><span class="cf">if</span>(<span class="kw">is.null</span>(tempcoef)){</a>
<a class="sourceLine" id="cb18-26" title="26"><span class="kw">cat</span>(<span class="st">&quot;Error in lm fit, skip coefficients</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb18-27" title="27">error_counter=error_counter<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb18-28" title="28">  } <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb18-29" title="29">coef_sum=coef_sum<span class="op">+</span><span class="kw">abs</span>(tempcoef)</a>
<a class="sourceLine" id="cb18-30" title="30">}</a>
<a class="sourceLine" id="cb18-31" title="31">}</a>
<a class="sourceLine" id="cb18-32" title="32">error_counter</a>
<a class="sourceLine" id="cb18-33" title="33">coef_mean=coef_sum<span class="op">/</span>NDatasets</a>
<a class="sourceLine" id="cb18-34" title="34">coef_lasso_mean=coef_lasso_sum<span class="op">/</span>NDatasets</a></code></pre></div>
<p>With regular least squares and lasso estimators all fits were sucessful, yet only 20 variables coefficients could be estimated with regular least squares estimates for the linear model. Then we display and plot that the mean coefficient vector values for the least squares estimates.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">coef_mean</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw">barplot</span>(coef_mean)</a>
<a class="sourceLine" id="cb19-3" title="3"><span class="kw">abline</span>(<span class="dt">h=</span>(minB<span class="op">+</span>maxB)<span class="op">/</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">coef_lasso_mean</a>
<a class="sourceLine" id="cb20-2" title="2"><span class="kw">barplot</span>(coef_lasso_mean,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>))</a>
<a class="sourceLine" id="cb20-3" title="3"><span class="kw">abline</span>(<span class="dt">h=</span>(minB<span class="op">+</span>maxB)<span class="op">/</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p>The simulation process looks sucessfull: the lasso estimates retrives mostly the correct variables, yet the other ones are also selected sometimes. What are the confidence indices for those variables?</p>
</div>
</div>
<div id="third-example" class="section level1">
<h1>Third Example</h1>
<div id="aim-2" class="section level2">
<h2>Aim</h2>
<p>We want to creates <span class="math inline">\(NDatasets=200\)</span> datasets with <span class="math inline">\(\textrm{length}(supp)=100\)</span> variables and <span class="math inline">\(N=24\)</span> observations. In that example we use real data for the <code>X</code> variables that we sample from all the <span class="math inline">\(1650\)</span> probesets that are differentially expressed between the two conditions US and S. The main interest of that simulation is that the correlation structure of the <code>X</code> dataset will be a real one.</p>
</div>
<div id="data-and-response-generations" class="section level2">
<h2>Data and response generations</h2>
<p>First retrieve the datasets and get the differentially expressed probesets. Run the code to get additionnal plots.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">require</span>(CascadeData)</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw">data</span>(micro_S)</a>
<a class="sourceLine" id="cb21-3" title="3"><span class="kw">data</span>(micro_US)</a>
<a class="sourceLine" id="cb21-4" title="4"><span class="kw">require</span>(Cascade)</a>
<a class="sourceLine" id="cb21-5" title="5">micro_US&lt;-<span class="kw">as.micro_array</span>(micro_US,<span class="kw">c</span>(<span class="dv">60</span>,<span class="dv">90</span>,<span class="dv">240</span>,<span class="dv">390</span>),<span class="dv">6</span>)</a>
<a class="sourceLine" id="cb21-6" title="6">micro_S&lt;-<span class="kw">as.micro_array</span>(micro_S,<span class="kw">c</span>(<span class="dv">60</span>,<span class="dv">90</span>,<span class="dv">240</span>,<span class="dv">390</span>),<span class="dv">6</span>)</a>
<a class="sourceLine" id="cb21-7" title="7">S&lt;-<span class="kw">geneSelection</span>(<span class="kw">list</span>(micro_S,micro_US),<span class="kw">list</span>(<span class="st">&quot;condition&quot;</span>,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dv">1</span>),<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb21-8" title="8">Sel&lt;-micro_S<span class="op">@</span>microarray[S<span class="op">@</span>name,]</a></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">summary</span>(S)</a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">plot</span>(S)</a></code></pre></div>
<p>Generates the datasets sampling for each of them 100 probesets expressions among the 1650 that were selected and linking the response to the expressions of the first five probesets.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">set.seed</span>(<span class="dv">3141</span>)</a>
<a class="sourceLine" id="cb24-2" title="2">supp&lt;-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">95</span>))</a>
<a class="sourceLine" id="cb24-3" title="3">minB&lt;-<span class="dv">1</span></a>
<a class="sourceLine" id="cb24-4" title="4">maxB&lt;-<span class="dv">2</span></a>
<a class="sourceLine" id="cb24-5" title="5">stn&lt;-<span class="dv">50</span></a>
<a class="sourceLine" id="cb24-6" title="6">NDatasets=<span class="dv">200</span></a>
<a class="sourceLine" id="cb24-7" title="7"></a>
<a class="sourceLine" id="cb24-8" title="8"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb24-9" title="9">X&lt;-<span class="kw">t</span>(<span class="kw">as.matrix</span>(Sel[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Sel),<span class="dv">100</span>),]))</a>
<a class="sourceLine" id="cb24-10" title="10">Xnorm&lt;-<span class="kw">t</span>(<span class="kw">t</span>(X)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">colSums</span>(X<span class="op">*</span>X)))</a>
<a class="sourceLine" id="cb24-11" title="11"><span class="kw">assign</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple3_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="kw">simulation_DATA</span>(Xnorm,supp,minB,maxB,stn))</a>
<a class="sourceLine" id="cb24-12" title="12">}</a></code></pre></div>
</div>
<div id="checks-1" class="section level2">
<h2>Checks</h2>
<p>Here are the plots of an example of correlation structure, namely for <code>DATA_exemple3_nb_200$X</code>. Run the code to get the graphics.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">plot</span>(<span class="kw">cor</span>(Xnorm))</a>
<a class="sourceLine" id="cb25-2" title="2">mixOmics<span class="op">::</span><span class="kw">cim</span>(<span class="kw">cor</span>(Xnorm))</a></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">coef_sum=<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(supp))</a>
<a class="sourceLine" id="cb26-2" title="2">coef_lasso_sum=<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(supp))</a>
<a class="sourceLine" id="cb26-3" title="3"><span class="kw">names</span>(coef_sum)&lt;-<span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(supp),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb26-4" title="4"><span class="kw">names</span>(coef_lasso_sum)&lt;-<span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(supp),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb26-5" title="5">error_counter=<span class="dv">0</span></a>
<a class="sourceLine" id="cb26-6" title="6"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb26-7" title="7">tempdf=<span class="kw">data.frame</span>(<span class="kw">cbind</span>(<span class="dt">Y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple3_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y,</a>
<a class="sourceLine" id="cb26-8" title="8">                        <span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple3_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X))</a>
<a class="sourceLine" id="cb26-9" title="9">tempcoef=<span class="kw">coef</span>(<span class="kw">lm</span>(Y<span class="op">~</span>.<span class="op">-</span><span class="dv">1</span>,<span class="dt">data=</span>tempdf))</a>
<a class="sourceLine" id="cb26-10" title="10"><span class="kw">require</span>(lars)</a>
<a class="sourceLine" id="cb26-11" title="11">lasso<span class="fl">.1</span> &lt;-<span class="st"> </span>lars<span class="op">::</span><span class="kw">lars</span>(<span class="dt">x=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple3_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X,</a>
<a class="sourceLine" id="cb26-12" title="12">              <span class="dt">y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple3_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y, <span class="dt">type=</span><span class="st">&quot;lasso&quot;</span>, </a>
<a class="sourceLine" id="cb26-13" title="13">              <span class="dt">trace=</span><span class="ot">FALSE</span>, <span class="dt">normalize=</span><span class="ot">FALSE</span>, <span class="dt">intercept =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb26-14" title="14"><span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span></a>
<a class="sourceLine" id="cb26-15" title="15">cv.lasso<span class="fl">.1</span> &lt;-<span class="st"> </span>lars<span class="op">::</span><span class="kw">cv.lars</span>(<span class="dt">x=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple3_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X,</a>
<a class="sourceLine" id="cb26-16" title="16">              <span class="dt">y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple3_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y, </a>
<a class="sourceLine" id="cb26-17" title="17">              <span class="dt">plot.it=</span><span class="ot">FALSE</span>, <span class="dt">normalize=</span><span class="ot">FALSE</span>, <span class="dt">intercept =</span> <span class="ot">FALSE</span>, <span class="dt">type=</span><span class="st">&quot;lasso&quot;</span>)</a>
<a class="sourceLine" id="cb26-18" title="18"><span class="co"># Use the &quot;+1SE rule&quot; to find best model: </span></a>
<a class="sourceLine" id="cb26-19" title="19"><span class="co">#    Take the min CV and add its SE (&quot;limit&quot;).  </span></a>
<a class="sourceLine" id="cb26-20" title="20"><span class="co">#    Find smallest model that has its own CV within this limit (at &quot;s.cv.1&quot;)</span></a>
<a class="sourceLine" id="cb26-21" title="21">limit &lt;-<span class="st"> </span><span class="kw">min</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv) <span class="op">+</span><span class="st"> </span>cv.lasso<span class="fl">.1</span><span class="op">$</span>cv.error[<span class="kw">which.min</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv)]</a>
<a class="sourceLine" id="cb26-22" title="22">s.cv<span class="fl">.1</span> &lt;-<span class="st"> </span>cv.lasso<span class="fl">.1</span><span class="op">$</span>index[<span class="kw">min</span>(<span class="kw">which</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv <span class="op">&lt;</span><span class="st"> </span>limit))]</a>
<a class="sourceLine" id="cb26-23" title="23"><span class="co"># Print out coefficients at optimal s.</span></a>
<a class="sourceLine" id="cb26-24" title="24">coef_lasso_sum=coef_lasso_sum<span class="op">+</span><span class="kw">abs</span>(<span class="kw">coef</span>(lasso<span class="fl">.1</span>, <span class="dt">s=</span>s.cv<span class="fl">.1</span>, <span class="dt">mode=</span><span class="st">&quot;fraction&quot;</span>))</a>
<a class="sourceLine" id="cb26-25" title="25"><span class="cf">if</span>(<span class="kw">is.null</span>(tempcoef)){</a>
<a class="sourceLine" id="cb26-26" title="26"><span class="kw">cat</span>(<span class="st">&quot;Error in lm fit, skip coefficients</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb26-27" title="27">error_counter=error_counter<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb26-28" title="28">  } <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb26-29" title="29">coef_sum=coef_sum<span class="op">+</span><span class="kw">abs</span>(tempcoef)</a>
<a class="sourceLine" id="cb26-30" title="30">}</a>
<a class="sourceLine" id="cb26-31" title="31">}</a>
<a class="sourceLine" id="cb26-32" title="32">error_counter</a>
<a class="sourceLine" id="cb26-33" title="33">coef_mean=coef_sum<span class="op">/</span>NDatasets</a>
<a class="sourceLine" id="cb26-34" title="34">coef_lasso_mean=coef_lasso_sum<span class="op">/</span>NDatasets</a></code></pre></div>
<p>With regular least squares and lasso estimators all fits were sucessful, yet only 20 variables coefficients could be estimated with regular least squares estimates for the linear model. Then we display and plot that the mean coefficient vector values for the least squares estimates.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">coef_mean</a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw">barplot</span>(coef_mean)</a>
<a class="sourceLine" id="cb27-3" title="3"><span class="kw">abline</span>(<span class="dt">h=</span>(minB<span class="op">+</span>maxB)<span class="op">/</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">coef_lasso_mean</a>
<a class="sourceLine" id="cb28-2" title="2"><span class="kw">barplot</span>(coef_lasso_mean,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>))</a>
<a class="sourceLine" id="cb28-3" title="3"><span class="kw">abline</span>(<span class="dt">h=</span>(minB<span class="op">+</span>maxB)<span class="op">/</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p>The simulation process looks sucessfull: the lasso estimates retrives mostly the correct variables, yet the other ones are also selected sometimes. What are the confidence indices for those variables?</p>
</div>
</div>
<div id="fourth-example" class="section level1">
<h1>Fourth Example</h1>
<div id="aim-3" class="section level2">
<h2>Aim</h2>
<p>We want to creates <span class="math inline">\(NDatasets=101\)</span> datasets with <span class="math inline">\(\textrm{length}(supp)=100\)</span> variables and <span class="math inline">\(N=18\)</span> observations. In that example we use real data for the variables that are the <span class="math inline">\(101\)</span> probesets that are the more differentially expressed between the two conditions US and S. We create <span class="math inline">\(101\)</span> datasets by leaving one of the variables out each time and using it as the response that shall be predicted. We also only use for the explanatory variables the observations that are the measurements for the 1st, 2nd and 3rd timepoints and for the responses the observations that are the measurements of the same variables for the 2nd, 3rd and 4th timepoints. The main interest of that simulation is that the correlation structure of the <code>X</code> dataset will be a real one and that it is a typical setting for cascade network reverse-engineering in genomics or proteomics, see the <code>Cascade</code> package for more details.</p>
</div>
<div id="data-and-response-generations-1" class="section level2">
<h2>Data and response generations</h2>
<p>First retrieve the datasets and get the differentially expressed probesets. Run the code to get additionnal plots.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">require</span>(CascadeData)</a>
<a class="sourceLine" id="cb29-2" title="2"><span class="kw">data</span>(micro_S)</a>
<a class="sourceLine" id="cb29-3" title="3"><span class="kw">data</span>(micro_US)</a>
<a class="sourceLine" id="cb29-4" title="4"><span class="kw">require</span>(Cascade)</a>
<a class="sourceLine" id="cb29-5" title="5">micro_US&lt;-<span class="kw">as.micro_array</span>(micro_US,<span class="kw">c</span>(<span class="dv">60</span>,<span class="dv">90</span>,<span class="dv">240</span>,<span class="dv">390</span>),<span class="dv">6</span>)</a>
<a class="sourceLine" id="cb29-6" title="6">micro_S&lt;-<span class="kw">as.micro_array</span>(micro_S,<span class="kw">c</span>(<span class="dv">60</span>,<span class="dv">90</span>,<span class="dv">240</span>,<span class="dv">390</span>),<span class="dv">6</span>)</a>
<a class="sourceLine" id="cb29-7" title="7">S&lt;-<span class="kw">geneSelection</span>(<span class="kw">list</span>(micro_S,micro_US),<span class="kw">list</span>(<span class="st">&quot;condition&quot;</span>,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dv">1</span>),<span class="dv">101</span>)</a>
<a class="sourceLine" id="cb29-8" title="8">Sel&lt;-micro_S<span class="op">@</span>microarray[S<span class="op">@</span>name,]</a></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">summary</span>(S)</a></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">plot</span>(S)</a></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">suppt&lt;-<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="dv">6</span>)</a>
<a class="sourceLine" id="cb32-2" title="2">supp&lt;-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">95</span>)) <span class="co">#not used since we use one of the probeset expressions as response</span></a>
<a class="sourceLine" id="cb32-3" title="3">minB&lt;-<span class="dv">1</span> <span class="co">#not used since we use one of the probeset expressions as response</span></a>
<a class="sourceLine" id="cb32-4" title="4">maxB&lt;-<span class="dv">2</span> <span class="co">#not used since we use one of the probeset expressions as response</span></a>
<a class="sourceLine" id="cb32-5" title="5">stn&lt;-<span class="dv">50</span> <span class="co">#not used since we use one of the probeset expressions as response</span></a>
<a class="sourceLine" id="cb32-6" title="6">NDatasets&lt;-<span class="dv">101</span></a>
<a class="sourceLine" id="cb32-7" title="7"></a>
<a class="sourceLine" id="cb32-8" title="8"><span class="kw">set.seed</span>(<span class="dv">3141</span>)</a>
<a class="sourceLine" id="cb32-9" title="9"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb32-10" title="10">  <span class="co">#the explanatory variables are the values for the 1st, 2nd and 3rd timepoints</span></a>
<a class="sourceLine" id="cb32-11" title="11">  X&lt;-<span class="kw">t</span>(<span class="kw">as.matrix</span>(Sel[<span class="op">-</span>i,suppt<span class="op">!=</span><span class="dv">4</span>]))</a>
<a class="sourceLine" id="cb32-12" title="12">  Xnorm&lt;-<span class="kw">t</span>(<span class="kw">t</span>(X)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">colSums</span>(X<span class="op">*</span>X)))</a>
<a class="sourceLine" id="cb32-13" title="13">  DATA&lt;-<span class="kw">simulation_DATA</span>(Xnorm,supp,minB,maxB,stn)</a>
<a class="sourceLine" id="cb32-14" title="14">  <span class="co">#the reponses are the values for the 2nd, 3rd and 4th timepoints</span></a>
<a class="sourceLine" id="cb32-15" title="15">  DATA<span class="op">$</span>Y&lt;-<span class="kw">as.vector</span>(<span class="kw">t</span>(Sel[i,suppt<span class="op">!=</span><span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb32-16" title="16">  <span class="kw">assign</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple4_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),DATA)</a>
<a class="sourceLine" id="cb32-17" title="17">  <span class="kw">rm</span>(DATA)</a>
<a class="sourceLine" id="cb32-18" title="18">}</a></code></pre></div>
</div>
<div id="checks-2" class="section level2">
<h2>Checks</h2>
<p>Here are the plots of an example of correlation structure, namely for <code>DATA_exemple3_nb_200$X</code>. Run the code to get the graphics.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">plot</span>(<span class="kw">cor</span>(Xnorm))</a>
<a class="sourceLine" id="cb33-2" title="2">mixOmics<span class="op">::</span><span class="kw">cim</span>(<span class="kw">cor</span>(Xnorm))</a></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">coef_sum=<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(supp)<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb34-2" title="2">coef_lasso_sum=<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(supp)<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb34-3" title="3"><span class="kw">names</span>(coef_sum)&lt;-<span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>,<span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(supp)<span class="op">+</span><span class="dv">1</span>),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb34-4" title="4"><span class="kw">names</span>(coef_lasso_sum)&lt;-<span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>,<span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(supp)<span class="op">+</span><span class="dv">1</span>),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb34-5" title="5">error_counter=<span class="dv">0</span></a>
<a class="sourceLine" id="cb34-6" title="6"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb34-7" title="7">tempdf=<span class="kw">data.frame</span>(<span class="kw">cbind</span>(<span class="dt">Y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple4_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y,</a>
<a class="sourceLine" id="cb34-8" title="8">                        <span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple4_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X))</a>
<a class="sourceLine" id="cb34-9" title="9">tempcoef=<span class="kw">coef</span>(<span class="kw">lm</span>(Y<span class="op">~</span>.<span class="op">-</span><span class="dv">1</span>,<span class="dt">data=</span>tempdf))</a>
<a class="sourceLine" id="cb34-10" title="10"><span class="kw">require</span>(lars)</a>
<a class="sourceLine" id="cb34-11" title="11">lasso<span class="fl">.1</span> &lt;-<span class="st"> </span>lars<span class="op">::</span><span class="kw">lars</span>(<span class="dt">x=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple4_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X,</a>
<a class="sourceLine" id="cb34-12" title="12">              <span class="dt">y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple4_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y, <span class="dt">type=</span><span class="st">&quot;lasso&quot;</span>, </a>
<a class="sourceLine" id="cb34-13" title="13">              <span class="dt">trace=</span><span class="ot">FALSE</span>, <span class="dt">normalize=</span><span class="ot">FALSE</span>, <span class="dt">intercept =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb34-14" title="14"><span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span></a>
<a class="sourceLine" id="cb34-15" title="15">cv.lasso<span class="fl">.1</span> &lt;-<span class="st"> </span>lars<span class="op">::</span><span class="kw">cv.lars</span>(<span class="dt">x=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple4_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X,</a>
<a class="sourceLine" id="cb34-16" title="16">              <span class="dt">y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple4_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y, </a>
<a class="sourceLine" id="cb34-17" title="17">              <span class="dt">plot.it=</span><span class="ot">FALSE</span>, <span class="dt">normalize=</span><span class="ot">FALSE</span>, <span class="dt">intercept =</span> <span class="ot">FALSE</span>, <span class="dt">type=</span><span class="st">&quot;lasso&quot;</span>)</a>
<a class="sourceLine" id="cb34-18" title="18"><span class="co"># Use the &quot;+1SE rule&quot; to find best model: </span></a>
<a class="sourceLine" id="cb34-19" title="19"><span class="co">#    Take the min CV and add its SE (&quot;limit&quot;).  </span></a>
<a class="sourceLine" id="cb34-20" title="20"><span class="co">#    Find smallest model that has its own CV within this limit (at &quot;s.cv.1&quot;)</span></a>
<a class="sourceLine" id="cb34-21" title="21">limit &lt;-<span class="st"> </span><span class="kw">min</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv) <span class="op">+</span><span class="st"> </span>cv.lasso<span class="fl">.1</span><span class="op">$</span>cv.error[<span class="kw">which.min</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv)]</a>
<a class="sourceLine" id="cb34-22" title="22">s.cv<span class="fl">.1</span> &lt;-<span class="st"> </span>cv.lasso<span class="fl">.1</span><span class="op">$</span>index[<span class="kw">min</span>(<span class="kw">which</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv <span class="op">&lt;</span><span class="st"> </span>limit))]</a>
<a class="sourceLine" id="cb34-23" title="23"><span class="co"># Print out coefficients at optimal s.</span></a>
<a class="sourceLine" id="cb34-24" title="24">coef_lasso_sum[<span class="op">-</span>i]=coef_lasso_sum[<span class="op">-</span>i]<span class="op">+</span><span class="kw">abs</span>(<span class="kw">coef</span>(lasso<span class="fl">.1</span>, <span class="dt">s=</span>s.cv<span class="fl">.1</span>, <span class="dt">mode=</span><span class="st">&quot;fraction&quot;</span>))</a>
<a class="sourceLine" id="cb34-25" title="25"><span class="cf">if</span>(<span class="kw">is.null</span>(tempcoef)){</a>
<a class="sourceLine" id="cb34-26" title="26"><span class="kw">cat</span>(<span class="st">&quot;Error in lm fit, skip coefficients</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb34-27" title="27">error_counter=error_counter<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb34-28" title="28">  } <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb34-29" title="29">coef_sum[<span class="op">-</span>i]=coef_sum[<span class="op">-</span>i]<span class="op">+</span><span class="kw">abs</span>(tempcoef)</a>
<a class="sourceLine" id="cb34-30" title="30">}</a>
<a class="sourceLine" id="cb34-31" title="31">}</a>
<a class="sourceLine" id="cb34-32" title="32">error_counter</a>
<a class="sourceLine" id="cb34-33" title="33">coef_mean=coef_sum<span class="op">/</span>NDatasets</a>
<a class="sourceLine" id="cb34-34" title="34">coef_lasso_mean=coef_lasso_sum<span class="op">/</span>NDatasets</a></code></pre></div>
<p>With regular least squares and lasso estimators all fits were sucessful, yet only 20 variables coefficients could be estimated with regular least squares estimates for the linear model. Then we display and plot that the mean coefficient vector values for the least squares estimates.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">head</span>(coef_mean, <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb35-2" title="2"><span class="kw">barplot</span>(coef_mean)</a>
<a class="sourceLine" id="cb35-3" title="3"><span class="kw">abline</span>(<span class="dt">h=</span>(minB<span class="op">+</span>maxB)<span class="op">/</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="kw">head</span>(coef_lasso_mean, <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb36-2" title="2"><span class="kw">barplot</span>(coef_lasso_mean)</a></code></pre></div>
<p>Some probesets seem explanatory for many other ones (=hubs). What are the confidence indices for those variables?</p>
</div>
</div>
<div id="fifth-example" class="section level1">
<h1>Fifth Example</h1>
<div id="aim-4" class="section level2">
<h2>Aim</h2>
<p>We want to creates <span class="math inline">\(NDatasets=200\)</span> datasets with <span class="math inline">\(\textrm{length}(group)=500\)</span> variables and <span class="math inline">\(N=25\)</span> observations. In that example we want <span class="math inline">\(1\)</span> group:</p>
<ul>
<li><span class="math inline">\(x_1\)</span>, , <span class="math inline">\(x_{500}\)</span> belong to the same group and the intra-group Pearson correlation for this group is equal to <span class="math inline">\(.5\)</span>.</li>
<li>only the first five variables <span class="math inline">\(x_1\)</span>, , <span class="math inline">\(x_{5}\)</span> are explanatory variables for the response.</li>
</ul>
</div>
<div id="correlation-structure-2" class="section level2">
<h2>Correlation structure</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1">  group&lt;-<span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">500</span>) <span class="co">#500 variables</span></a>
<a class="sourceLine" id="cb37-2" title="2">  cor_group&lt;-<span class="kw">rep</span>(<span class="fl">0.5</span>,<span class="dv">1</span>)</a></code></pre></div>
</div>
<div id="explanatory-variables-and-response-1" class="section level2">
<h2>Explanatory variables and response</h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="kw">set.seed</span>(<span class="dv">3141</span>)</a>
<a class="sourceLine" id="cb38-2" title="2">N&lt;-<span class="dv">25</span></a>
<a class="sourceLine" id="cb38-3" title="3">supp&lt;-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">495</span>))</a>
<a class="sourceLine" id="cb38-4" title="4">minB&lt;-<span class="dv">1</span></a>
<a class="sourceLine" id="cb38-5" title="5">maxB&lt;-<span class="dv">2</span></a>
<a class="sourceLine" id="cb38-6" title="6">stn&lt;-<span class="dv">50</span></a>
<a class="sourceLine" id="cb38-7" title="7"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb38-8" title="8">  C&lt;-<span class="kw">simulation_cor</span>(group,cor_group)</a>
<a class="sourceLine" id="cb38-9" title="9">  X&lt;-<span class="kw">simulation_X</span>(N,C)</a>
<a class="sourceLine" id="cb38-10" title="10">  <span class="kw">assign</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple5_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="kw">simulation_DATA</span>(X,supp,minB,maxB,stn))</a>
<a class="sourceLine" id="cb38-11" title="11">}</a></code></pre></div>
</div>
<div id="checks-3" class="section level2">
<h2>Checks</h2>
<p>We now check the correlation structure of the explanatory variable. First we compute the mean correlation matrix.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">corr_sum=<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(group),<span class="kw">length</span>(group))</a>
<a class="sourceLine" id="cb39-2" title="2"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb39-3" title="3">corr_sum=corr_sum<span class="op">+</span><span class="kw">cor</span>(<span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple5_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X)</a>
<a class="sourceLine" id="cb39-4" title="4">}</a>
<a class="sourceLine" id="cb39-5" title="5">corr_mean=corr_sum<span class="op">/</span>NDatasets</a></code></pre></div>
<p>Then we display and plot that the mean correlation matrix.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1">corr_mean[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb40-2" title="2"><span class="kw">plot</span>(<span class="kw">abs</span>(corr_mean))</a></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1">coef_sum=<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(group))</a>
<a class="sourceLine" id="cb41-2" title="2">coef_lasso_sum=<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(group))</a>
<a class="sourceLine" id="cb41-3" title="3"><span class="kw">names</span>(coef_sum)&lt;-<span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(group),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb41-4" title="4"><span class="kw">names</span>(coef_lasso_sum)&lt;-<span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(group),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb41-5" title="5">error_counter=<span class="dv">0</span></a>
<a class="sourceLine" id="cb41-6" title="6"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>NDatasets){</a>
<a class="sourceLine" id="cb41-7" title="7">tempdf=<span class="kw">data.frame</span>(<span class="kw">cbind</span>(<span class="dt">Y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple5_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y,</a>
<a class="sourceLine" id="cb41-8" title="8">                        <span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple5_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X))</a>
<a class="sourceLine" id="cb41-9" title="9">tempcoef=<span class="kw">coef</span>(<span class="kw">lm</span>(Y<span class="op">~</span>.<span class="op">-</span><span class="dv">1</span>,<span class="dt">data=</span>tempdf))</a>
<a class="sourceLine" id="cb41-10" title="10"><span class="kw">require</span>(lars)</a>
<a class="sourceLine" id="cb41-11" title="11">lasso<span class="fl">.1</span> &lt;-<span class="st"> </span>lars<span class="op">::</span><span class="kw">lars</span>(<span class="dt">x=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple5_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X,</a>
<a class="sourceLine" id="cb41-12" title="12">              <span class="dt">y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple5_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y, <span class="dt">type=</span><span class="st">&quot;lasso&quot;</span>, </a>
<a class="sourceLine" id="cb41-13" title="13">              <span class="dt">trace=</span><span class="ot">FALSE</span>, <span class="dt">normalize=</span><span class="ot">FALSE</span>, <span class="dt">intercept =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb41-14" title="14"><span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span></a>
<a class="sourceLine" id="cb41-15" title="15">cv.lasso<span class="fl">.1</span> &lt;-<span class="st"> </span>lars<span class="op">::</span><span class="kw">cv.lars</span>(<span class="dt">x=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple5_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>X,</a>
<a class="sourceLine" id="cb41-16" title="16">              <span class="dt">y=</span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">&quot;DATA_exemple5_nb_&quot;</span>,i,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">$</span>Y, </a>
<a class="sourceLine" id="cb41-17" title="17">              <span class="dt">plot.it=</span><span class="ot">FALSE</span>, <span class="dt">type=</span><span class="st">&quot;lasso&quot;</span>)</a>
<a class="sourceLine" id="cb41-18" title="18"><span class="co"># Use the &quot;+1SE rule&quot; to find best model: </span></a>
<a class="sourceLine" id="cb41-19" title="19"><span class="co">#    Take the min CV and add its SE (&quot;limit&quot;).  </span></a>
<a class="sourceLine" id="cb41-20" title="20"><span class="co">#    Find smallest model that has its own CV within this limit (at &quot;s.cv.1&quot;)</span></a>
<a class="sourceLine" id="cb41-21" title="21">limit &lt;-<span class="st"> </span><span class="kw">min</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv) <span class="op">+</span><span class="st"> </span>cv.lasso<span class="fl">.1</span><span class="op">$</span>cv.error[<span class="kw">which.min</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv)]</a>
<a class="sourceLine" id="cb41-22" title="22">s.cv<span class="fl">.1</span> &lt;-<span class="st"> </span>cv.lasso<span class="fl">.1</span><span class="op">$</span>index[<span class="kw">min</span>(<span class="kw">which</span>(cv.lasso<span class="fl">.1</span><span class="op">$</span>cv <span class="op">&lt;</span><span class="st"> </span>limit))]</a>
<a class="sourceLine" id="cb41-23" title="23"><span class="co"># Print out coefficients at optimal s.</span></a>
<a class="sourceLine" id="cb41-24" title="24">coef_lasso_sum=coef_lasso_sum<span class="op">+</span><span class="kw">abs</span>(<span class="kw">coef</span>(lasso<span class="fl">.1</span>, <span class="dt">s=</span>s.cv<span class="fl">.1</span>, <span class="dt">mode=</span><span class="st">&quot;fraction&quot;</span>))</a>
<a class="sourceLine" id="cb41-25" title="25"><span class="cf">if</span>(<span class="kw">is.null</span>(tempcoef)){</a>
<a class="sourceLine" id="cb41-26" title="26"><span class="kw">cat</span>(<span class="st">&quot;Error in lm fit, skip coefficients</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb41-27" title="27">error_counter=error_counter<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb41-28" title="28">  } <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb41-29" title="29">coef_sum=coef_sum<span class="op">+</span><span class="kw">abs</span>(tempcoef)</a>
<a class="sourceLine" id="cb41-30" title="30">}</a>
<a class="sourceLine" id="cb41-31" title="31">}</a>
<a class="sourceLine" id="cb41-32" title="32">error_counter</a>
<a class="sourceLine" id="cb41-33" title="33">coef_mean=coef_sum<span class="op">/</span>NDatasets</a>
<a class="sourceLine" id="cb41-34" title="34">coef_lasso_mean=coef_lasso_sum<span class="op">/</span>NDatasets</a></code></pre></div>
<p>With regular least squares and lasso estimators all fits were sucessful, yet only 20 variables coefficients could be estimated with regular least squares estimates for the linear model. Then we display and plot that the mean coefficient vector values for the least squares estimates.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="kw">head</span>(coef_mean, <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb42-2" title="2"><span class="kw">barplot</span>(coef_mean)</a>
<a class="sourceLine" id="cb42-3" title="3"><span class="kw">abline</span>(<span class="dt">h=</span>(minB<span class="op">+</span>maxB)<span class="op">/</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="kw">head</span>(coef_lasso_mean, <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb43-2" title="2"><span class="kw">barplot</span>(coef_lasso_mean,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>))</a>
<a class="sourceLine" id="cb43-3" title="3"><span class="kw">abline</span>(<span class="dt">h=</span>(minB<span class="op">+</span>maxB)<span class="op">/</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p>The simulation process looks sucessfull: the lasso estimates retrives mostly the correct variables, yet the other ones are also selected sometimes. What are the confidence indices for those variables?</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
